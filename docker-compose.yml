# =============================================================================
# Curatr App - Docker Compose Configuration
# =============================================================================
# This is an example configuration. Adjust paths and settings for your setup.
# See README.md for full documentation of all environment variables.

services:
  curatr-app:
    image: ghcr.io/lou-i3/curatr-app:latest
    container_name: curatr-app
    ports:
      - "3000:3000"

    environment:
      # --- Core Settings ---
      - NODE_ENV=production
      - DATABASE_URL=file:/app/data/media-tracker.db

      # --- Timezone & Permissions ---
      - TZ=Europe/Paris
      - PUID=1000
      - PGID=1000

      # --- Media Library Paths (at least one required) ---
      - TV_SHOWS_PATH=/media/TV Shows
      # - MOVIES_PATH=/media/Movies

      # --- TMDB Integration ---
      # Get your API key at: https://www.themoviedb.org/settings/api
      # - TMDB_API_KEY=your-read-access-token

      # --- FFprobe Integration ---
      # See docs/ffprobe-docker-setup.md for setup instructions
      # - FFPROBE_PATH=/usr/bin/ffprobe
      # - FFPROBE_TIMEOUT=30000

      # --- Scanner Settings ---
      # - SCAN_CONCURRENCY=4
      # - SCAN_BATCH_SIZE=100

      # --- Task System ---
      # - TASK_RETENTION_MS=3600000

      # --- Plex Authentication (optional) ---
      # - AUTH_MODE=plex
      # - PLEX_URL=http://your-plex-server:32400
      # - PLEX_TOKEN=your-plex-token

    volumes:
      # Database persistence (required)
      - ./data:/app/data

      # Media library mounts (read-only recommended)
      - /path/to/tv-shows:/media/TV Shows:ro
      # - /path/to/movies:/media/Movies:ro

      # Optional: Plex database for future sync feature
      # - /path/to/plex/database:/plex-db:ro

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/api/health', (r) => {if (r.statusCode !== 200) throw new Error(r.statusCode)})"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
